{#
  Copyright (C) 2020 CERN.
  Copyright (C) 2020 Northwestern University.
  Copyright (C) 2021 New York University.

  Invenio RDM Records is free software; you can redistribute it and/or modify
  it under the terms of the MIT License; see LICENSE file for more details.
#}

{%- set subjects = record.metadata.subjects -%}

{% if record_topics %}
  {%- for scheme, topics in record_topics|selectattr("scheme")|groupby('scheme')|sort(attribute='scheme') %}
  <dl class="details-list subjects" aria-label="{{ _('Special topics') }}">
    <dt class="ui tiny header">{{scheme}}</dt>
    {%- for topic in topics %}
    <dd>
      <a href="/search?q={{ topic.model_field  }}:'{{ topic.title }}'"
         class="subject"
         title="{{ _('Search results for ') + topic.title }}"
      >
        {{ topic.title }}
      </a>
    </dd>
    {%- endfor %}
  </dl>
  {%- endfor %}
{% endif %}

{% if subjects %}
  {%- for scheme, subjects in subjects|selectattr("scheme")|groupby('scheme')|sort(attribute='scheme') %}
  <dl class="details-list subjects" aria-label="{{ _('Subjects') }}">
    <dt class="ui tiny header">{{scheme}}</dt>
    {%- for subject in subjects %}
    <dd>
      <a href='/search?q=metadata.subjects.subject:"{{ subject.subject }}"'
         class="subject"
         title="{{ _('Search results for ') + subject.subject }}"
      >
        {{ subject.subject }}
      </a>
    </dd>
    {%- endfor %}
  </dl>
  {%- endfor %}

  {% set keywords = subjects|rejectattr("scheme")|list %}
  {% if keywords %}
  <dl class="details-list subjects" aria-label="{{ _('Keywords') }}">
    <dt class="ui tiny header">{{ _('Keywords') }}</dt>
    {%- for subject in keywords %}
      <dd>
        <a href='/search?q=metadata.subjects.subject:"{{ subject.subject }}"'
           class="subject"
           title="{{ _('Search results for ') + subject.subject }}"
        >
          {{ subject.subject }}
        </a>
      </dd>
    {%- endfor %}
  </dl>
  {% endif %}
{% endif %}
